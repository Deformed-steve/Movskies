<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Movie & TV Browser</title>
<style>
  body { background:#111; color:#fff; font-family:Arial; margin:0; }
  header { display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background:#222; flex-wrap:wrap; }
  header h1 { margin:0; font-size:20px; }
  nav, .categories { display:flex; align-items:center; margin-top:5px; flex-wrap:wrap; }
  nav button, .categories button { margin:5px 5px 0 0; padding:5px 10px; background:#444; color:#fff; border:none; border-radius:4px; cursor:pointer; }
  nav button.active, .categories button.active { background:#e50914; }
  #searchBar { padding:5px; width:200px; border-radius:4px; border:none; }

  .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:10px; padding:20px; }
  img { width:100%; border-radius:8px; cursor:pointer; transition:transform 0.2s; }
  img:hover { transform:scale(1.05); }

  /* Overlay player */
  #overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); display:none; justify-content:center; align-items:center; flex-direction:column; z-index:1000; }
  #overlay iframe { width:90%; height:80%; border:none; border-radius:10px; }
  #closeBtn { position:absolute; top:20px; right:20px; background:#e50914; color:#fff; border:none; border-radius:50%; width:35px; height:35px; font-size:18px; cursor:pointer; }
</style>
</head>
<body>
<header>
  <h1>ðŸŽ¬ Movie & TV Browser</h1>
  <input id="searchBar" type="text" placeholder="Search...">
  <nav>
    <button id="moviesTab" class="active">Movies</button>
    <button id="tvTab">TV Shows</button>
  </nav>
  <div class="categories" id="categoriesDiv"></div>
</header>

<div id="content" class="grid"></div>

<!-- Overlay Player -->
<div id="overlay">
  <button id="closeBtn">âœ–</button>
  <iframe id="player" allowfullscreen></iframe>
</div>

<script>
const API_KEY = "a63b70ca6288b339b0b556535449d1b9";
let currentPage = 1;
let currentType = "movie"; // "movie" or "tv"
let currentCategory = "popular";
let currentQuery = null;
let isLoading = false;

const contentDiv = document.getElementById("content");
const searchBar = document.getElementById("searchBar");
const overlay = document.getElementById("overlay");
const player = document.getElementById("player");
const closeBtn = document.getElementById("closeBtn");
const categoriesDiv = document.getElementById("categoriesDiv");

// Category options
const categories = {
  movie: [
    { label: "Trending", value: "popular" },
    { label: "In Theaters", value: "now_playing" },
    { label: "Top Rated", value: "top_rated" },
    { label: "Upcoming", value: "upcoming" }
  ],
  tv: [
    { label: "Trending", value: "popular" },
    { label: "Newest", value: "on_the_air" },
    { label: "Top Rated", value: "top_rated" }
  ]
};

// Load items from TMDb
async function loadItems(reset=false) {
  if(isLoading) return;
  isLoading = true;

  let url;
  if(currentQuery) {
    url = `https://api.themoviedb.org/3/search/${currentType}?api_key=${API_KEY}&query=${encodeURIComponent(currentQuery)}&page=${currentPage}`;
  } else {
    url = `https://api.themoviedb.org/3/${currentType}/${currentCategory}?api_key=${API_KEY}&page=${currentPage}`;
  }

  const res = await fetch(url);
  const data = await res.json();

  if(reset) contentDiv.innerHTML = "";
  data.results.forEach(item => {
    if(!item.poster_path) return;
    const img = document.createElement("img");
    img.src = `https://image.tmdb.org/t/p/w300${item.poster_path}`;
    img.alt = currentType==="movie"?item.title:item.name;
    img.onclick = () => showOverlay(item.id);
    contentDiv.appendChild(img);
  });

  isLoading = false;
}

// Show player overlay
function showOverlay(id){
  player.src = `https://vidsrc.cc/v2/embed/${currentType}/${id}`;
  overlay.style.display = "flex";
}
closeBtn.onclick = () => { overlay.style.display="none"; player.src=""; };

// Set up tabs
document.getElementById("moviesTab").onclick = () => switchType("movie");
document.getElementById("tvTab").onclick = () => switchType("tv");

function switchType(type){
  currentType = type;
  currentPage = 1;
  currentQuery = null;
  currentCategory = categories[type][0].value;
  updateTabs();
  renderCategories();
  loadItems(true);
}

function updateTabs(){
  document.getElementById("moviesTab").classList.toggle("active", currentType==="movie");
  document.getElementById("tvTab").classList.toggle("active", currentType==="tv");
}

// Render category buttons
function renderCategories(){
  categoriesDiv.innerHTML = "";
  categories[currentType].forEach(cat=>{
    const btn = document.createElement("button");
    btn.textContent = cat.label;
    btn.dataset.category = cat.value;
    if(cat.value===currentCategory) btn.classList.add("active");
    btn.onclick = () => {
      currentCategory = cat.value;
      currentPage = 1;
      currentQuery = null;
      document.querySelectorAll("#categoriesDiv button").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      loadItems(true);
    };
    categoriesDiv.appendChild(btn);
  });
}

// Search
searchBar.addEventListener("keypress", (e)=>{
  if(e.key==="Enter"){
    currentQuery = searchBar.value.trim();
    currentPage=1;
    loadItems(true);
  }
});

// Infinite scroll
window.addEventListener("scroll", ()=>{
  if(window.innerHeight + window.scrollY >= document.body.offsetHeight - 500 && !isLoading){
    currentPage++;
    loadItems();
  }
});

// Initial setup
renderCategories();
loadItems(true);
</script>
</body>
</html>
